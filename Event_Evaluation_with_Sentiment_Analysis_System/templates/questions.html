<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Details</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        a,
        button,
        input,
        select,
        h1,
        h2,
        h3,
        h4,
        h5,
        * {
            margin: 0;
            padding: 0;
            border: none;
            text-decoration: none;
            appearance: none;
            background: none;
        }
    </style>
</head>
<body>
    <div class="background">
        <header class="header">
            <nav class="navbar">
                <ul class="menu">
                    <li><a href="{{ url_for('home') }}" class="home-link"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="{{ url_for('questions') }}">Form</a></li>
                    <li><a href="#" class="settings-link">Settings</a></li>
                </ul>
            </nav>
        </header>
        <div class="form-container">
            <form action="{{ url_for('save_form') }}" method="post">
                <div class="box">
                    <input type="text" class="title-input" name="title" id="title" placeholder="Form Title" required>
                    <input type="text" class="desc-input" name="description" id="description" placeholder="Description" required>
                    <div class="line"></div>
                </div>

                <div class="box2">
                    <div class="quadrant upper-left">
                        <input type="text" class="question-input" name="question_text_{{ boxCounter }}" placeholder="Question">
                    </div>

                    <div class="quadrant upper-right">
                        <img id="dropdownImg" src="{{ url_for('static', filename='images/dropdown.png') }}" alt="Dropdown Icon" class="dropdownimg">
                        <select id="dropdown" class="dropdown" name="question_type_{{ boxCounter }}">
                            <option value="Open-Ended Response">Open-Ended Response</option>
                            <option value="Multiple Choices">Multiple Choices</option>
                            <option value="CheckBox">CheckBox</option>
                        </select>
                    </div>

                    <div class="quadrant lower-left">
                        <p class="selected-option"><span id="selectedOption">Open-Ended Response</span></p>
                        <div class="options-container"></div>
                    </div>

                    <div class="quadrant lower-right">
                        <span class="switch1-text">Required</span>
                        <label class="switch1">
                            <input type="checkbox" name="is_required_{{ boxCounter }}">
                            <span class="slider1 round"></span>
                        </label>
                    </div>
                </div>

                <div class="icon-box">
                    <i class="fas fa-trash delete-icon" id="delete-icon"></i>
                    <i class="fas fa-clone duplicate-icon"></i>
                    <i class="fas fa-plus-circle add-icon"></i>
                </div>
                <input type="hidden" name="html_content" id="html_content">
                <div class="save-button">
                    <button type="submit" id="save-button">Save</button>
                </div>
                <div class="link-button">
                    <button type="submit" id="link-button">Share Link</button>
                </div>
            </form>
        </div>
    <div class="settings-modal" id="settings-modal">
        <form action="">
        <div class="settings">
            <h1 class="header">Customize your form</h1>
            <hr class="hr1">
            <div class="input-box">
                <input type="text" placeholder="Insert Form Title" class="form-title">
                <input type="text" placeholder="Insert Form Description" class="form-description">
                <input type="text" placeholder="Insert Submission Confirmation Message" class="message">
                <input type="text" placeholder="Question" class="question">
            </div>
            <div class="dropdown_1">
                <select name="fonts_1" id="dropdown_1">
                    <option value="Arial">Arial</option>
                    <option value="Calibri">Calibri</option>
                    <option value="Option3">Times New Roman</option>
                </select>
            </div>
            <div class="dropdown_2">
                <select name="size_1" id="dropdown_2">
                    <option value="12">12</option>
                    <option value="14">14</option>
                    <option value="16">16</option>
                </select>
            </div>
            <div class="dropdown_3">
                <select name="fonts_2" id="dropdown_3">
                    <option value="Arial">Arial</option>
                    <option value="Calibri">Calibri</option>
                    <option value="Option3">Times New Roman</option>
                </select>
            </div>
            <div class="dropdown_4">
                <select name="fonts_3" id="dropdown_4">
                    <option value="Arial">Calibri</option>
                    <option value="Calibri">Arial</option>
                    <option value="Option3">Times New Roman</option>
                </select>
            </div>
            <div class="dropdown_5">
                <select name="size_2" id="dropdown_5">
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="14">14</option>
                </select>
            </div>
            <div class="dropdown_6">
                <select name="size_3" id="dropdown_6">
                    <option value="11">12</option>
                    <option value="12">16</option>
                    <option value="14">14</option>
                </select>
            </div>
            <hr class="hr2">
            <div class="dropdown_7">
                <select name="fonts_4" id="dropdown_7">
                    <option value="Calibri">Calibri</option>
                    <option value="Arial">Arial</option>
                    <option value="Times New Roman">Times New Roman</option>
                </select>
            </div>
            <div class="dropdown_8">
                <select name="size_4" id="dropdown_8">
                    <option value="13">13</option>
                    <option value="12">12</option>
                    <option value="14">14</option>
                </select>
            </div>
            <hr class="hr3">
            <h2 class="primary-text">Primary Color</h2>
            <div class="primary-picker">
                <input type="color" id="primary" class="primary">
                <img src="images/palette.png" alt="Color Palette" class="color-picker-icon">
            </div>
            <h2 class="secondary-text">Secondary Color</h2>
            <div class="secondary-picker">
                <input type="color" id="secondary" class="secondary">
                <img src="images/palette.png" alt="Color Palette" class="color-picker-icon">
            </div>
            <div class="text">
                <p class="info">Personal Information</p>
            </div>
            <p class="text-req">Required</p>
            <label class="switch">
                <input type="checkbox">
                <span class="slider round"></span>
            </label>
            <button type="submit" class="save-settings">Save Settings</button>
        </div>
        </form>
    </div>
</body>
</html>
<script>
    let optionCounter = 1;

    function createOptionElement(inputType, boxCounter) {
    const newOption = document.createElement("div");
    newOption.className = "option";
    newOption.innerHTML = `
        <input type="${inputType}" class="option-input" value="">
        <input type="text" class="option-label" name="choices_${boxCounter}" placeholder="Option label">
        <button class="delete-option"><i class="fas fa-trash"></i></button>
    `;
    optionCounter++;

    newOption.querySelector(".delete-option").addEventListener("click", function () {
        newOption.remove();
    });

    return newOption;
}


 function addOption(optionsContainer, inputType, questionCounter) {
    const newOption = createOptionElement(inputType, questionCounter, optionCounter);
    optionsContainer.appendChild(newOption);
}

    function handleDropdownChange(dropdown, selectedOptionElement, optionsContainer, questionCounter) {
        const selectedValue = dropdown.value;
        selectedOptionElement.textContent = selectedValue;

        // Clear the options container
        optionsContainer.innerHTML = '';

        if (selectedValue === "Open-Ended Response") {
            optionsContainer.innerHTML = '<p class="selected-option">Open-Ended <span id="selectedOption">Response</span></p>';
        } else if (selectedValue === "Multiple Choices" || selectedValue === "CheckBox") {
            const optionsContainerDiv = document.createElement("div");
            optionsContainerDiv.className = "options-container";
            optionsContainer.appendChild(optionsContainerDiv);

            addOption(optionsContainerDiv, selectedValue === "Multiple Choices" ? "radio" : "checkbox", questionCounter);

            const addOptionButton = document.createElement("button");
            addOptionButton.className = "add-option";
            addOptionButton.type = "button";
            addOptionButton.textContent = "Add Option";

            addOptionButton.addEventListener("click", function () {
                addOption(optionsContainerDiv, selectedValue === "Multiple Choices" ? "radio" : "checkbox");
            });

            optionsContainer.appendChild(addOptionButton);

            selectedOptionElement.parentElement.style.display = 'none';
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        let boxCounter = 0; // Initialize a counter for the boxes

        const addIcon = document.querySelector(".add-icon"); // Select the add-icon element
        const form = document.querySelector("form");
        const iconBox = document.querySelector(".icon-box");

        addIcon.addEventListener("click", function () {
            // Increment the box counter for each new box
            boxCounter++;

            const newBox2 = document.createElement("div");
            newBox2.className = "box2";
            newBox2.id = `box-${boxCounter}`;
            newBox2.innerHTML = `
        <div class="quadrant upper-left">
            <input type="text" class="question-input" name="question_text_${boxCounter}" placeholder="Question">
        </div>

        <div class="quadrant upper-right">
            <img id="dropdownImg" src="{{ url_for('static', filename='images/dropdown.png') }}" alt="Dropdown Icon" class="dropdownimg">
            <select id="dropdown" class="dropdown" name="question_type_${boxCounter}">
                <option value="Open-Ended Response">Open-Ended Response</option>
                <option value="Multiple Choices">Multiple Choices</option>
                <option value="CheckBox">CheckBox</option>
            </select>
        </div>
        <div class="quadrant lower-left">
            <p class="selected-option"><span id="selectedOption">Open-Ended Response</span></p>
            <div class="options-container"></div>
        </div>
        <div class="quadrant lower-right">
            <span class="switch1-text">Required</span>
            <label class="switch1">
                <input type="checkbox" name="is_required_${boxCounter}">
                <span class="slider1 round"></span>
            </label>
        </div>
    `;
            form.insertBefore(newBox2, iconBox);

            const newDropdown = newBox2.querySelector(".dropdown");
            const newSelectedOption = newBox2.querySelector(".selected-option span");
            const newOptionsContainer = newBox2.querySelector(".options-container");

            newDropdown.addEventListener("change", function () {
                handleDropdownChange(newDropdown, newSelectedOption, newOptionsContainer);
            });
        });

        // Find and handle the original box2
        const originalDropdown = document.getElementById("dropdown");
        const originalSelectedOption = document.getElementById("selectedOption");
        const originalOptionsContainer = document.querySelector(".quadrant.lower-left");

        originalDropdown.addEventListener("change", function () {
            handleDropdownChange(originalDropdown, originalSelectedOption, originalOptionsContainer);
        });

        iconBox.querySelector(".delete-icon").addEventListener("click", function () {
            if (boxCounter > 0) {
                // Find and remove the most recent box
                const mostRecentBox = form.querySelector(`#box-${boxCounter}`);
                if (mostRecentBox) {
                    mostRecentBox.parentNode.removeChild(mostRecentBox);
                    boxCounter--; // Decrement the box counter
                }
            }
        });
    });

    document.querySelector("#save-button").addEventListener("click", function () {
        // Collect the form title and description
        const title = document.querySelector("#title").value;
        const description = document.querySelector("#description").value;

        // Create an object to hold the form data, including questions and choices
        const formData = {
            title: title,
            description: description,
            questions: []
        };

        // Variable to hold the captured data for alert
        let alertMessage = "Captured Choice Text:\n";

        // Find and iterate through all question elements
        document.querySelectorAll(".quadrant.upper-left").forEach(function (questionElement, questionCounter) {
            const questionText = questionElement.querySelector(".question-input").value;
            const questionType = questionElement.parentElement.querySelector(".dropdown").value;
            const isRequired = questionElement.parentElement.querySelector(".slider1").checked;

            // Create an object for the question
            const questionData = {
                question_text: questionText,
                question_type: questionType,
                is_required: isRequired,
                choices: []
            };

            // If the question type is Multiple Choices or CheckBox, collect choices
            if (questionType === "Multiple Choices" || questionType === "CheckBox") {
                const optionsContainer = questionElement.parentElement.querySelector(".options-container");
                optionsContainer.querySelectorAll(".option-label").forEach(function (choiceInput, choiceCounter) {
                    const choiceText = choiceInput.value;
                    // Create an object for the choice
                    const choiceData = {
                        choice_text: choiceText
                    };
                    // Push the choice object to the question's choices array
                    questionData.choices.push(choiceData);

                    // Add the choice text to the alert message
                    alertMessage += `Question ${questionCounter + 1}, Choice ${choiceCounter + 1}: ${choiceText}\n`;
                });
            }

            // Push the question object to the form's questions array
            formData.questions.push(questionData);
        });

        // Display the captured data in an alert
        alert(alertMessage);

        // Convert the formData object to JSON
        const formDataJSON = JSON.stringify(formData);

        // Set the JSON data as the value of the hidden input field
        document.querySelector("#html_content").value = formDataJSON;
    });

    document.addEventListener("DOMContentLoaded", function () {
        const settingsModal = document.getElementById("settings-modal");
        const settingsLink = document.querySelector(".settings-link");

        // Function to show the modal
        function showSettingsModal() {
            settingsModal.style.display = "block";
        }

        // Function to hide the modal
        function hideSettingsModal() {
            settingsModal.style.display = "none";
        }

        // Event handler for the "Settings" link in the menu
        settingsLink.addEventListener("click", function (event) {
            event.preventDefault(); // Prevent the default link behavior
            showSettingsModal();
        });

        // Close the modal when clicking outside of it
        window.addEventListener("click", function (event) {
            if (event.target === settingsModal) {
                hideSettingsModal();
            }
        });
    });

</script>