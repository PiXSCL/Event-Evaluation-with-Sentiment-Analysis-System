<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Details</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        a,
        button,
        input,
        select,
        h1,
        h2,
        h3,
        h4,
        h5,
        * {
            margin: 0;
            padding: 0;
            border: none;
            text-decoration: none;
            appearance: none;
            background: none;
        }
    </style>
</head>
<body>
    <div class="background">
        <header class="header">
            <!-- Your navigation menu -->
        </header>
        <div class="form-container">
            <form action="/update_form/{{ form_id }}" method="post">
                <div class="box">
                    <input type="text" class="title-input" name="title" id="title" placeholder="Form Title" value="{{ form.title }}" required>
                    <input type="text" class="desc-input" name="description" id="description" placeholder="Description" value="{{ form.description }}" required>
                    <div class="line"></div>
                </div>

                {% for question in form.questions %}
                <div class="box2">
                    <div class="quadrant upper-left">
                        <input type="text" class="question-input" name="question_text" value="{{ question.question_text }}">
                    </div>

                    <div class="quadrant upper-right">
                        <img id="dropdownImg" src="{{ url_for('static', filename='images/dropdown.png') }}" alt="Dropdown Icon" class="dropdownimg">
                        <select id="dropdown" class="dropdown" name="question_type">
                            <option value="Open-Ended Response" {% if question.question_type= ="Open-Ended Response" %} selected {% endif %}>Open-Ended Response</option>
                            <option value="Multiple Choices" {% if question.question_type= ="Multiple Choices" %} selected {% endif %}>Multiple Choices</option>
                            <option value="CheckBox" {% if question.question_type= ="CheckBox" %} selected {% endif %}>CheckBox</option>
                        </select>
                    </div>

                    <div class="quadrant lower-left">
                        {% for choice in question.choices %}
                        <input type="text" class="option-input" name="choices" value="{{ choice.choice_text }}">
                        {% endfor %}
                    </div>

                    <div class="quadrant lower-right">
                        <span class="switch-text">Required</span>
                        <label class="switch">
                            <input type="checkbox" name="is_required" {% if question.is_required %} checked {% endif %}>
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
                {% endfor %}

                <div class="icon-box">
                    <i class="fas fa-grip-vertical follow-up-icon"></i>
                    <i class="fas fa-trash delete-icon" id="delete-icon"></i>
                    <i class="fas fa-clone duplicate-icon"></i>
                    <i class="fas fa-plus-circle add-icon"></i>
                </div>
                <input type="hidden" name="html_content" id="html_content">
                <div class="save-button">
                    <button type="submit" id="save-button">Save</button>
                </div>
                <div class="link-button">
                    <button type="submit" id="link-button">Share Link</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
<script>
    let optionCounter = 1;

    function createOptionElement(inputType) {
        const newOption = document.createElement("div");
        newOption.className = "option";
        newOption.innerHTML = `
        <input type="${inputType}" class="option-input" name="options${optionCounter}" value="option${optionCounter}">
        <input type="text" class="option-label" placeholder="Option label">
        <button class="delete-option"><i class="fas fa-trash"></i></button>
    `;
        optionCounter++;

        newOption.querySelector(".delete-option").addEventListener("click", function () {
            newOption.remove();
        });

        return newOption;
    }

    function addOption(optionsContainer, inputType) {
        const newOption = createOptionElement(inputType);
        optionsContainer.appendChild(newOption);

    }

    function handleDropdownChange(dropdown, selectedOptionElement, optionsContainer) {
        const selectedValue = dropdown.value;
        selectedOptionElement.textContent = selectedValue;

        // Clear the options container
        optionsContainer.innerHTML = '';

        if (selectedValue === "Open-Ended Response") {
            optionsContainer.innerHTML = '<p class="selected-option">Open-Ended <span id="selectedOption">Response</span></p>';
        } else if (selectedValue === "Multiple Choices" || selectedValue === "CheckBox") {
            const optionsContainerDiv = document.createElement("div");
            optionsContainerDiv.className = "options-container";
            optionsContainer.appendChild(optionsContainerDiv);

            addOption(optionsContainerDiv, selectedValue === "Multiple Choices" ? "radio" : "checkbox");

            const addOptionButton = document.createElement("button");
            addOptionButton.className = "add-option";
            addOptionButton.type = "button";
            addOptionButton.textContent = "Add Option";

            addOptionButton.addEventListener("click", function () {
                addOption(optionsContainerDiv, selectedValue === "Multiple Choices" ? "radio" : "checkbox");
            });

            optionsContainer.appendChild(addOptionButton);

            selectedOptionElement.parentElement.style.display = 'none';
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        let boxCounter = 0; // Initialize a counter for the boxes

        const addIcon = document.querySelector(".add-icon"); // Select the add-icon element
        const form = document.querySelector("form");
        const iconBox = document.querySelector(".icon-box");

        addIcon.addEventListener("click", function () {
            // Increment the box counter for each new box
            boxCounter++;

            const newBox2 = document.createElement("div");
            newBox2.className = "box2";
            newBox2.id = `box-${boxCounter}`;
            newBox2.innerHTML = `
            <div class="quadrant upper-left">
                <input type="text" class="question-input" placeholder="Question">
            </div>
            <div class="quadrant upper-right">
                <img src="{{ url_for('static', filename='images/dropdown.png') }}" alt="Dropdown Icon" class="dropdownimg">
                <select class="dropdown">
                    <option value="Open-Ended Response">Open-Ended Response</option>
                    <option value="Multiple Choices">Multiple Choices</option>
                    <option value="CheckBox">CheckBox</option>
                </select>
            </div>
            <div class="quadrant lower-left">
                <p class="selected-option"><span>Open-Ended Response</span></p>
                <div class="options-container"></div>
            </div>
            <div class="quadrant lower-right">
                <span class="switch-text">Required</span>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider round"></span>
                </label>
            </div>
        `;
            form.insertBefore(newBox2, iconBox);

            const newDropdown = newBox2.querySelector(".dropdown");
            const newSelectedOption = newBox2.querySelector(".selected-option span");
            const newOptionsContainer = newBox2.querySelector(".options-container");

            newDropdown.addEventListener("change", function () {
                handleDropdownChange(newDropdown, newSelectedOption, newOptionsContainer);
            });
        });

        // Find and handle the original box2
        const originalDropdown = document.getElementById("dropdown");
        const originalSelectedOption = document.getElementById("selectedOption");
        const originalOptionsContainer = document.querySelector(".quadrant.lower-left");

        originalDropdown.addEventListener("change", function () {
            handleDropdownChange(originalDropdown, originalSelectedOption, originalOptionsContainer);
        });

        iconBox.querySelector(".delete-icon").addEventListener("click", function () {
            if (boxCounter > 0) {
                const mostRecentBox = form.querySelector(`#box-${boxCounter}`);
                if (mostRecentBox) {
                    mostRecentBox.parentNode.removeChild(mostRecentBox);
                    boxCounter--;
                }
            }
        });
    });

    document.querySelector("#save-button").addEventListener("click", function () {
        const htmlContent = document.documentElement.outerHTML;
        document.querySelector("#html_content").value = htmlContent;
    });
</script>