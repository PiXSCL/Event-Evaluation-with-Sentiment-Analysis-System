<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Cabin">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        a,
        button,
        input,
        select,
        h1,
        h2,
        h3,
        h4,
        h5,
        * {
            margin: 0;
            padding: 0;
            border: none;
            text-decoration: none;
            appearance: none;
            background: none;
        }
    </style>
    <title>Home Page</title>
</head>
<body>
    <div class ="background">
        <div class="rectangle-3"></div>
        <div class="home-navbar" id="home-navbar">
            <div class="user-profile">
                <img src="{{ url_for('static', filename='images/profile.svg') }}" alt="Profile Picture">
                <span class="home-email">ryujin@gmail.com</span>
            </div>
            <div class="home-buttons">
                <button class="new-form">New Form</button>
            </div>
            <div class="add">
                <img id="clickable-image" src="{{ url_for('static', filename='images/add.png') }}" alt="Add icon">
            </div>
        </div>
        <span class ="sort" id="sortText">Sorted by Date Created</span>
        <div class="custom-dropdown">
            <div class="dropdown-header" onclick="toggleDropdown()">
                <img src="{{ url_for('static', filename='images/filter.png') }}" alt="Dropdown Icon">
            </div>
            <div class="dropdown-content" id="dropdown-content" style="display: none;">
                <a href="#">Title</a>
                <a href="#">Date Created</a>
            </div>
       </div>
       <div class="search-container">
            <button type="submit"><i class="fa fa-search"></i></button>
            <input type="text" placeholder="Search">
        </div>
     </div>
    <div class="data-grid-container">
        <div class="data-grid">
            {% for form_id, form_title in form_data %}
               <div class="data-grid-item">
                    <div class="item-content">
                        <div class="title-label">{{ form_title }}</div>
                        <div class="option-container" onclick="toggleOptionMenu(this)">
                            <img class="option" id="option_{{ form_id }}" src="{{ url_for('static', filename='images/option.png') }}" alt="Options Icon">
                            <div class="option-menu" id="dropdown-content" style="display: none;">
                                <a href="#">Edit</a>
                                <a href="#">Delete</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <body>
</body>
<script>
    function toggleDropdown() {
        const dropdownContent = document.getElementById('dropdown-content');
        if (dropdownContent.style.display === 'block') {
            dropdownContent.style.display = 'none';
        } else {
            dropdownContent.style.display = 'block';
        }
    }
    function updateSortText(selectedItem) {
        document.getElementById('sortText').textContent = `Sorted by ${selectedItem}`;
    }

    document.querySelectorAll('.dropdown-content a').forEach(function (item) {
        item.addEventListener('click', function () {
            const selectedItem = this.textContent;
            updateSortText(selectedItem);
            toggleDropdown();
        });
    });
    window.onclick = function (event) {
        const dropdownContent = document.getElementById('dropdown-content');
        if (event.target !== dropdownContent && !event.target.closest('.custom-dropdown')) {
            dropdownContent.style.display = 'none';
        }
    }

    // Add an event listener to each option container to toggle the menu
    document.querySelectorAll('.option-container').forEach(function (container) {
        container.addEventListener('click', function (event) {
            const optionMenu = container.querySelector('.option-menu');
            optionMenu.style.display = (optionMenu.style.display === 'block') ? 'none' : 'block';
            event.stopPropagation(); // Prevent body click event from firing
        });

        // Add an event listener to each option menu to prevent menu clicks from closing it
        container.querySelector('.option-menu').addEventListener('click', function (event) {
            event.stopPropagation(); // Prevent the click from reaching the body click event
        });
    });

    // Add an event listener to the document body to handle clicks outside the menu
    document.body.addEventListener('click', function (event) {
        document.querySelectorAll('.option-menu').forEach(function (menu) {
            menu.style.display = 'none';
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
        // Add click event listeners to all option buttons
        const optionButtons = document.querySelectorAll(".option");
        optionButtons.forEach(function (button) {
            button.addEventListener("click", function () {
                const optionMenu = button.nextElementSibling; // Get the sibling option menu
                optionMenu.classList.toggle("hidden"); // Toggle the 'hidden' class
            });
        });

        // Add a click event listener to the entire document
        document.addEventListener("click", function (event) {
            const clickedElement = event.target;

            // Check if the clicked element is an option button or inside an option container
            const isOptionButton = clickedElement.classList.contains("option");
            const isOptionMenu = clickedElement.classList.contains("option-menu");

            // If the click is outside an option button or menu, hide all option menus
            if (!isOptionButton && !isOptionMenu) {
                const allOptionMenus = document.querySelectorAll(".option-menu");
                allOptionMenus.forEach(function (menu) {
                    menu.classList.add("hidden");
                });
            }
        });
    });

</script>
</html>