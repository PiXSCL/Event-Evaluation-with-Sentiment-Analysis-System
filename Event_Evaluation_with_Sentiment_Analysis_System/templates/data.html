<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analytics</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        a,
        button,
        input,
        select,
        h1,
        h2,
        h3,
        h4,
        h5,
        * {
            margin: 0;
            padding: 0;
            border: none;
            text-decoration: none;
            appearance: none;
            background: none;
        }
    </style>
</head>
<body>
    <div class="background">
        <header class="header">
            <nav class="navbar">
                <ul class="menu">
                    <li><a href="{{ url_for('home') }}" class="home-link"><i class="fas fa-home"></i> Home</a></li>
                    <li><a href="{{ url_for('questions') }}">Questions</a></li>
                    <li><a href="">Settings</a></li>
                    <li><a href="{{ url_for('data') }}">Data Analytics</a></li>
                </ul>
            </nav>
            <nav class="sidebar">
                <ul class="sidebar-menu">
                    <li><a href="{{ url_for('data') }}">Overall Summary</a></li>
                    <li><a href="{{ url_for('data_summary') }}">Summary Per Question</a></li>
                    <li><a href="">Responses per Sentiment</a></li>
                    <li><a href="">Answers Per Question</a></li>
                    <li><a href="">Individual Responses</a></li>
                </ul>

            </nav>
        </header>
        <div class="data-container">
            <div class="qbox"><span>Overall Summary</span></div>
            <div class="response-container">
                <h2>Open Ended Summary</h2>
                <div id="piechart" class="overall-piechart"></div>
                <div class="response-count">
                    <img class="respondent1-img" src="{{ url_for('static', filename='images/user-icon.svg') }}" alt="User">
                    <span>Respondents: {{ total_respondents }}</span> 
                </div>
                <div class="summary">
                    <span>{{ summary }}</span>
                </div>
                <button class="details-button">Details</button>
                <div class="modal">
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <h2>Questions with Responses:</h2>
                        <ul>
                            {% for response, question in responses_with_questions %}
                                <li>Question: {{ question.question_text }}</li>
                                <li>Response: {{ response.response }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
<div class="rectangle-3"></div> 
</body>
</html>
<script>
    // Get all "Details" buttons and modal elements
    var buttons = document.querySelectorAll('.details-button');
    var modals = document.querySelectorAll('.modal');

    // Add a click event listener to each "Details" button
    buttons.forEach(function (button, index) {
        button.addEventListener('click', function () {
            modals[index].style.display = 'block';
        });
    });

    // Add a click event listener to each close button (the "x" icon)
    var closeButtons = document.querySelectorAll('.close');
    closeButtons.forEach(function (closeButton) {
        closeButton.addEventListener('click', function () {
            closeButton.parentElement.parentElement.style.display = 'none';
        });
    });

    // When the user clicks anywhere outside the modal, close it
    window.addEventListener('click', function (event) {
        modals.forEach(function (modal) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });
    });

    // Close the modal when the user presses the Esc key
    window.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            modals.forEach(function (modal) {
                modal.style.display = 'none';
            });
        }
    });

    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
        // Define the chart data (chartData variable is passed from Flask)
        var data = google.visualization.arrayToDataTable({{ chart_data | safe }});

    var options = {
        title: 'Sentiment Analysis Results',
        backgroundColor: 'transparent',
    };

    var chart = new google.visualization.PieChart(document.getElementById('piechart'));

    chart.draw(data, options);
    }
</script>
